## 目的
このファイルは、チャットがリセットされた後でも作業を継続できるように、
本プロジェクトの概要および作業ログをリポジトリ上に恒久的に保存する目的で作成されたものです。

---
## ルール
- チャットの会話には日本語を使用すること。
- 指示や要望に不明点や混乱がある場合は、作業に入る前に必ず確認すること。
- 手順や段取りはStep By Stepで進めること。
- 返答は簡潔に。
- コードの変更は、最小限の差分にとどめること。
- 指示があるまで、リファクタリングはしない事。
- コード変更は、ユーザの承認（「改修実施」の指示）を得るまで絶対に実行しないこと。
- コード変更の前に、どのような意図でどこに、どう変更するかを示すこと。
- ログが貼り付けられた場合は、何が起きたのか説明し、エラーがある場合はその内容と原因、対処法を提示すること。
- Gitへの書き込み操作は絶対に行わないこと。
- このファイルで`Codex`が変更できるのは「現状サマリ」と「作業ログ」のみ。
- コメントは簡潔に、英語、日本語の順で記載すること。
  例:
    // this comment.
    // これはコメントです。
- このプロジェクト monorepo なので、同名のファイルを扱う時はパッケージ名を明示すること。
- 原則 import を優先し、対応しないモジュールのみ require を使用すること。
> ＊＊＊＊ 以上のルールを必ず守ること、すぐ忘れるから気をつけろ ＊＊＊＊

---
## 注意事項（絶対の注意をはらうこと！！！）
- monorepo であることを忘れて関係のないコード変更しコード破壊してしまう事故が度々発生している
- npmの公開要件があるので、testとnpm公開状態でimportパスが変わってしまう

---
## プロジェクトの概要
MongoDB Atlas が App Services を廃止したことを受けて、その代替手段を提供することを目的とする。
MongoDB Atlas / MongoDB との接続とユーザー認証の仕組みのみを実装し、既存の Realm 依存アプリケーションが最小限のコード変更で移行できるようにする。

---
## 技術構成

### 使用技術
- 言語: TypeScript
- パッケージ管理: pnpm
- データベース接続: MongoDB Node.js Driver
- 認証: JSON Web Tokens (JWT)
- テスト: Jest

### パッケージの構成と役割
モノレポ (monorepo) を使用し、次の3つのパッケージで構成されている
- revlm-server：MongoDB Atlas / MongoDB と接続し、認証とクライアントからのリクエスト仲介を提供
- revlm-client：アプリに組み込んで使用するクライアントライブラリ、revlm-server に接続してデータベースの操作を行う
- revlm-shared：型定義やユーティリティ関数など、revlm-server と revlm-client の共通で使用

各パッケージは独立した npm パッケージとして公開可能な設計

---
## 現状サマリ
# Date: 2025-11-23
- root.tsconfig.paths: Added direct entry mappings for `@kedaruma/revlm-{client,shared}` so package-name imports resolve consistently in build/test; ルートtsconfig.pathsにクライアント/シェアードのエントリマッピングを追加しビルド/テスト両方でパッケージ名インポートを安定化。
- jest.config/resolver: ts-jest now uses `moduleResolution: nodenext` with custom resolver fallback to `.ts` when `.js` re-exports are requested, enabling NodeNext-style packages during tests; Jest構成をNodeNext解決＋カスタムリゾルバ化し、`.js`再エクスポートでもテスト時に`.ts`へフォールバックして解決。
- workspace scripts: `pnpm clean` fan-outs to child packages and `pnpm test` sequentially runs each package’s Jest command with `--watchman=false`; ワークスペーススクリプトとして`pnpm clean`が各子パッケージに波及し、`pnpm test`は`--watchman=false`付きで各Jestスイートを順次実行。
- revlm-shared entry: `index.ts` re-export now uses `.js` suffix for NodeNext compliance; builds succeed, while `pnpm test` currently fails because `mongodb-memory-server` cannot bind ports under sandbox (EPERM); `revlm-shared`のエントリ再エクスポートを`.js`拡張子に統一しビルド成功、ただし`mongodb-memory-server`がEPERMでポート待受不可のため`pnpm test`は環境制限で失敗中。
- package descriptions/README: Added descriptions to each package.json and introduced README templates (root and per-package) to satisfy npm publishing requirements; 各package.jsonにdescriptionを追加し、ルート/各パッケージへREADME雛形を追加してnpm公開要件を満たした。

---
## 作業ログ（GitHub Copilotが追加）
> ＊＊＊＊ 簡潔に現在の進捗と問題点をまとめる事

## コマンドスニペット（コピペで実行）
### 依存復元
```bash
pnpm install
```

### パッケージ単体ビルド
```bash
pnpm --filter @kedaruma/revlm-shared run build
pnpm --filter @kedaruma/revlm-server run build
```

### テスト
```bash
# 個別
pnpm exec jest packages/revlm-server/src/__tests__/auth.test.ts --runInBand --verbose

# グループ
pnpm exec jest packages/revlm-server/src/__tests__/ --runInBand --verbose

# 全体
pnpm test
```

### Project References（全体ビルド）
```bash
pnpm build
```

### ローカル公開物検証
```bash
# 全パッケージのパッチバージョンのインクリメント
pnpm bump:patch

# 公開用にビルド
pnpm build:packages

# 全パッケージパブリッシュ（あらかじめコミットしておかないとエラーが出る）
pnpm publish:all

# 個別パブリッシュ
pnpm publish --filter @kedaruma/revlm-client --access public

```
